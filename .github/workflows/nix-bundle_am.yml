name: nix-bundle arknights-mower
on: [ push ]

#   push:
#     paths:
#       - 'pkgs/arknights-mower'

jobs:
  nix-bundle:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        arch: [ "linux/amd64", "linux/arm64/v8" ]

    container:
      image: alpine:latest
      options: --platform ${{ matrix.arch }}

    steps:
      - uses: actions/checkout@v1

      - run: apk add bash
      - uses: cachix/install-nix-action@v15
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - run: nix-shell nix-scripts/bundle-am.nix

      - uses: actions/upload-artifact@v2
        with:
          path: arknights-mower
