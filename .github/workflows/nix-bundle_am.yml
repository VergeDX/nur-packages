name: nix-bundle arknights-mower
on: [ push ]

#   push:
#     paths:
#       - 'pkgs/arknights-mower'

jobs:
  nix-bundle:
    runs-on: ubuntu-latest

    env:
      CH: https://nixos.org/channels/nixos-21.11

    strategy:
      matrix:
        container: [
            "nixos/nix:latest-amd64",
            "nixos/nix:latest-arm64"
        ]

    container:
      image: ${{ matrix.container }}

    steps:
      # https://github.com/actions/checkout/issues/334
      - uses: actions/checkout@v1

      - run: nix-channel --add ${{ env.CH }} nixpkgs
      - run: nix-channel --update
      - run: nix-shell nix-scripts/bundle-am.nix

      - uses: actions/upload-artifact@v2
        with:
          path: arknights-mower
